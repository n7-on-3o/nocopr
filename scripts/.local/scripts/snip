#!/usr/bin/env bash

# --- 1. PREVENT MULTIPLE INSTANCES ---
# If slurp is already running, the user is currently selecting. Exit.
if pgrep -x "slurp" > /dev/null; then
    exit 0
fi

# If swappy is already running, an editor is already open. Exit.
if pgrep -x "swappy" > /dev/null; then
    exit 0
fi

# --- 2. SETUP ---
DIR="$HOME/Pictures/Screenshots"
mkdir -p "$DIR"
SOUND="/usr/share/sounds/freedesktop/stereo/camera-shutter.oga"

play_sound() {
    if [ -f "$SOUND" ]; then
        pw-play "$SOUND" &
    fi
}

# --- 3. CAPTURE LOGIC ---
if [ "$1" == "full" ]; then
    play_sound
    grim - | swappy -f -
else
    # The 'slurp' overlay with your Catppuccin Blue theme
    AREA=$(slurp -b "#24273aaa" -c "#8aadf4" -s "#8aadf422" -w 2)
    
    # If the user cancels (Esc or Right Click), AREA is empty
    if [ -z "$AREA" ]; then
        exit 0
    fi
    
    play_sound
    grim -g "$AREA" - | swappy -f -
fi
